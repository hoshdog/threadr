<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threadr Fixes Verification</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #1a1a1a; color: white; }
        .test-result { margin: 10px 0; padding: 15px; border-radius: 8px; }
        .success { background: #065f46; border: 1px solid #10b981; }
        .error { background: #7f1d1d; border: 1px solid #ef4444; }
        .pending { background: #365314; border: 1px solid #eab308; }
    </style>
</head>
<body class="p-8">
    <div x-data="verificationApp()" x-init="runTests()">
        <h1 class="text-3xl font-bold mb-6">ðŸ”§ Threadr Fixes Verification</h1>
        
        <div class="space-y-6">
            <!-- Logo Fix Verification -->
            <section>
                <h2 class="text-2xl font-semibold mb-4">1. Logo Loading Test</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="test-result" :class="logoTest.status === 'success' ? 'success' : logoTest.status === 'error' ? 'error' : 'pending'">
                        <h3 class="font-semibold">Black Logo Test</h3>
                        <img src="/logos/threadrLogo_Black.png" alt="Black Logo" class="w-16 h-16 my-2" 
                             @load="logoTest.blackLogo = 'success'; checkLogoTest()" 
                             @error="logoTest.blackLogo = 'error'; checkLogoTest()">
                        <p x-text="logoTest.blackResult"></p>
                    </div>
                    
                    <div class="test-result" :class="logoTest.status === 'success' ? 'success' : logoTest.status === 'error' ? 'error' : 'pending'">
                        <h3 class="font-semibold">White Logo Test</h3>
                        <img src="/logos/threadrLogo_White.png" alt="White Logo" class="w-16 h-16 my-2" 
                             @load="logoTest.whiteLogo = 'success'; checkLogoTest()" 
                             @error="logoTest.whiteLogo = 'error'; checkLogoTest()">
                        <p x-text="logoTest.whiteResult"></p>
                    </div>
                </div>
                <div class="test-result mt-4" :class="logoTest.status === 'success' ? 'success' : logoTest.status === 'error' ? 'error' : 'pending'">
                    <p><strong>Overall Logo Test:</strong> <span x-text="logoTest.message"></span></p>
                </div>
            </section>

            <!-- Template Functions Test -->
            <section>
                <h2 class="text-2xl font-semibold mb-4">2. Template Functions Test</h2>
                <div class="test-result" :class="templateTest.status === 'success' ? 'success' : templateTest.status === 'error' ? 'error' : 'pending'">
                    <h3 class="font-semibold">Template Data Availability</h3>
                    <p><strong>Total Templates:</strong> <span x-text="templateTest.totalTemplates"></span></p>
                    <p><strong>Popular Templates:</strong> <span x-text="templateTest.popularCount"></span></p>
                    <p><strong>Filtered Templates:</strong> <span x-text="templateTest.filteredCount"></span></p>
                    <p><strong>Status:</strong> <span x-text="templateTest.message"></span></p>
                </div>
                
                <div class="test-result mt-4" :class="templateTest.functionsWork ? 'success' : 'error'">
                    <h3 class="font-semibold">Template Functions Test</h3>
                    <p x-text="templateTest.functionMessage"></p>
                </div>
            </section>

            <!-- Integration Test -->
            <section>
                <h2 class="text-2xl font-semibold mb-4">3. Integration Test</h2>
                <div class="test-result" :class="integrationTest.status === 'success' ? 'success' : integrationTest.status === 'error' ? 'error' : 'pending'">
                    <p><strong>Overall Status:</strong> <span x-text="integrationTest.message"></span></p>
                    <div class="mt-2">
                        <p>âœ… Vercel.json rewrite fix: Excludes static assets</p>
                        <p>âœ… Alpine.js template functions: Removed debugging returns</p>
                        <p x-text="integrationTest.summary"></p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        function verificationApp() {
            return {
                logoTest: {
                    blackLogo: 'pending',
                    whiteLogo: 'pending',
                    status: 'pending',
                    blackResult: 'Testing...',
                    whiteResult: 'Testing...',
                    message: 'Testing logo loading...'
                },
                templateTest: {
                    status: 'pending',
                    totalTemplates: 0,
                    popularCount: 0,
                    filteredCount: 0,
                    message: 'Testing template functions...',
                    functionsWork: false,
                    functionMessage: 'Testing...'
                },
                integrationTest: {
                    status: 'pending',
                    message: 'Running integration tests...',
                    summary: ''
                },
                
                // Mock template data for testing
                templates: [
                    {
                        id: 'test-1',
                        name: 'Test Template 1',
                        description: 'Test template',
                        category: 'Business',
                        isPro: false,
                        popularity: 85,
                        variables: ['test_var'],
                        structure: ['Test tweet']
                    },
                    {
                        id: 'test-2',
                        name: 'Test Template 2',
                        description: 'Test pro template',
                        category: 'Marketing',
                        isPro: true,
                        popularity: 90,
                        variables: ['test_var'],
                        structure: ['Test pro tweet']
                    }
                ],
                user: null, // No user for testing
                templateSearch: '',
                selectedCategory: 'all',

                checkLogoTest() {
                    if (this.logoTest.blackLogo !== 'pending' && this.logoTest.whiteLogo !== 'pending') {
                        if (this.logoTest.blackLogo === 'success' && this.logoTest.whiteLogo === 'success') {
                            this.logoTest.status = 'success';
                            this.logoTest.message = 'âœ… All logos loaded successfully! Vercel rewrite fix working.';
                        } else {
                            this.logoTest.status = 'error';
                            this.logoTest.message = 'âŒ Some logos failed to load. Check Vercel configuration.';
                        }
                        this.updateIntegrationTest();
                    }
                    
                    this.logoTest.blackResult = this.logoTest.blackLogo === 'success' ? 'âœ… Loaded successfully' : 'âŒ Failed to load';
                    this.logoTest.whiteResult = this.logoTest.whiteLogo === 'success' ? 'âœ… Loaded successfully' : 'âŒ Failed to load';
                },

                testTemplateFunctions() {
                    try {
                        // Test if functions exist and work
                        const popular = this.getPopularTemplates();
                        const filtered = this.getFilteredTemplates();
                        
                        this.templateTest.totalTemplates = this.templates.length;
                        this.templateTest.popularCount = popular.length;
                        this.templateTest.filteredCount = filtered.length;
                        
                        if (popular.length > 0 && filtered.length > 0) {
                            this.templateTest.status = 'success';
                            this.templateTest.message = 'âœ… Template functions working correctly!';
                            this.templateTest.functionsWork = true;
                            this.templateTest.functionMessage = 'âœ… getPopularTemplates() and getFilteredTemplates() both return data';
                        } else {
                            this.templateTest.status = 'error';
                            this.templateTest.message = 'âŒ Template functions not returning data';
                            this.templateTest.functionMessage = 'âŒ Functions exist but return empty arrays';
                        }
                    } catch (error) {
                        this.templateTest.status = 'error';
                        this.templateTest.message = 'âŒ Template functions error: ' + error.message;
                        this.templateTest.functionMessage = 'âŒ Functions threw error: ' + error.message;
                    }
                    
                    this.updateIntegrationTest();
                },

                // Template functions (copied from main app for testing)
                getPopularTemplates() {
                    const filtered = this.templates
                        .filter(template => {
                            if (template.isPro) {
                                return this.user && this.user.premium === true;
                            }
                            return template.popularity >= 75;
                        })
                        .sort((a, b) => b.popularity - a.popularity)
                        .slice(0, 6);
                    
                    if (filtered.length === 0) {
                        const fallback = this.templates
                            .filter(template => !template.isPro)
                            .sort((a, b) => b.popularity - a.popularity)
                            .slice(0, 6);
                        return fallback;
                    }
                    
                    return filtered;
                },

                getFilteredTemplates() {
                    let filtered = this.templates;

                    filtered = filtered.filter(template => {
                        if (template.isPro) {
                            return this.user && this.user.premium === true;
                        }
                        return true;
                    });

                    if (this.selectedCategory !== 'all') {
                        filtered = filtered.filter(template => template.category === this.selectedCategory);
                    }

                    if (this.templateSearch.trim()) {
                        const searchTerm = this.templateSearch.toLowerCase();
                        filtered = filtered.filter(template => 
                            template.name.toLowerCase().includes(searchTerm) ||
                            template.description.toLowerCase().includes(searchTerm) ||
                            template.category.toLowerCase().includes(searchTerm)
                        );
                    }

                    const result = filtered.sort((a, b) => b.popularity - a.popularity);
                    return result;
                },

                updateIntegrationTest() {
                    const logosPassed = this.logoTest.status === 'success';
                    const templatesPassed = this.templateTest.status === 'success';
                    
                    if (logosPassed && templatesPassed) {
                        this.integrationTest.status = 'success';
                        this.integrationTest.message = 'ðŸŽ‰ All fixes working! Ready for deployment.';
                        this.integrationTest.summary = 'âœ… Both logo loading and template functionality are working correctly.';
                    } else if (this.logoTest.status !== 'pending' && this.templateTest.status !== 'pending') {
                        this.integrationTest.status = 'error';
                        this.integrationTest.message = 'âš ï¸ Some fixes need attention before deployment.';
                        this.integrationTest.summary = `Logo fix: ${logosPassed ? 'PASS' : 'FAIL'}, Template fix: ${templatesPassed ? 'PASS' : 'FAIL'}`;
                    }
                },

                runTests() {
                    console.log('Starting verification tests...');
                    
                    // Test template functions immediately
                    setTimeout(() => {
                        this.testTemplateFunctions();
                    }, 500);
                    
                    // Logo tests run automatically via img onload/onerror events
                    
                    // Set a timeout for logos in case they don't load at all
                    setTimeout(() => {
                        if (this.logoTest.status === 'pending') {
                            this.logoTest.blackLogo = this.logoTest.blackLogo === 'pending' ? 'error' : this.logoTest.blackLogo;
                            this.logoTest.whiteLogo = this.logoTest.whiteLogo === 'pending' ? 'error' : this.logoTest.whiteLogo;
                            this.checkLogoTest();
                        }
                    }, 5000);
                }
            }
        }
    </script>
</body>
</html>