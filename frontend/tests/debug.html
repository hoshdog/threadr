<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threadr Debug Tool</title>
    <script src="config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Threadr Debug Tool</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">1. Configuration Status</h2>
            <div id="config-status" class="space-y-2 font-mono text-sm"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">2. API Test</h2>
            <button onclick="testAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Test API Connection
            </button>
            <div id="api-result" class="mt-4 font-mono text-sm"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">3. Request Headers</h2>
            <div id="headers-display" class="font-mono text-sm"></div>
        </div>
    </div>

    <script>
        // Display configuration status
        function displayConfig() {
            const status = document.getElementById('config-status');
            const info = [
                `Config loaded: ${typeof config !== 'undefined' ? 'YES' : 'NO'}`,
                `Current hostname: ${window.location.hostname}`,
                `Environment: ${config?.ENV || 'UNKNOWN'}`,
                `API URL: ${config?.API_URL || 'NOT SET'}`,
                `API Key present: ${config?.API_KEY ? 'YES' : 'NO'}`,
                `API Key value: ${config?.API_KEY ? config.API_KEY.substring(0, 10) + '...' : 'NONE'}`,
                `Should have API key: ${window.location.hostname.includes('vercel.app') ? 'YES' : 'NO'}`
            ];
            
            status.innerHTML = info.map(line => `<div class="py-1">${line}</div>`).join('');
        }

        // Test API connection
        async function testAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<div class="text-gray-500">Testing...</div>';
            
            const headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
            };
            
            // Add API key if available
            if (config?.API_KEY) {
                headers['X-API-Key'] = config.API_KEY;
            }
            
            // Display headers
            document.getElementById('headers-display').innerHTML = 
                '<pre>' + JSON.stringify(headers, null, 2) + '</pre>';
            
            try {
                // Test health endpoint
                const healthResponse = await fetch(`${config.API_URL}/health`, {
                    method: 'GET',
                    headers: headers,
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                const healthData = await healthResponse.text();
                
                // Test generate endpoint
                const generateResponse = await fetch(`${config.API_URL}/api/generate`, {
                    method: 'POST',
                    headers: headers,
                    mode: 'cors',
                    credentials: 'omit',
                    body: JSON.stringify({ text: 'Test thread generation' })
                });
                
                const generateData = await generateResponse.text();
                
                resultDiv.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <strong>Health Check:</strong>
                            <div class="text-${healthResponse.ok ? 'green' : 'red'}-600">
                                Status: ${healthResponse.status} ${healthResponse.statusText}
                            </div>
                            <pre class="mt-2 bg-gray-100 p-2 rounded text-xs overflow-auto">${healthData}</pre>
                        </div>
                        <div>
                            <strong>Generate Test:</strong>
                            <div class="text-${generateResponse.ok ? 'green' : 'red'}-600">
                                Status: ${generateResponse.status} ${generateResponse.statusText}
                            </div>
                            <pre class="mt-2 bg-gray-100 p-2 rounded text-xs overflow-auto">${generateData}</pre>
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">Error: ${error.message}</div>`;
            }
        }

        // Run on load
        window.onload = function() {
            displayConfig();
            
            // Log to console for debugging
            console.log('Debug page loaded');
            console.log('Config object:', config);
            console.log('API_KEY:', config?.API_KEY);
        };
    </script>
</body>
</html>